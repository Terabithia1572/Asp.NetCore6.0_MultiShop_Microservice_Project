@model IEnumerable<MultiShop.DTOLayer.FavoriteDTOs.ResultFavoriteDTO>

@{
    var hasItems = Model != null && Model.Any();
}

<div class="mini-fav-content p-3">
    @if (hasItems)
    {
        foreach (var item in Model)
        {
            <div class="mini-fav-item d-flex align-items-center justify-content-between mb-2">
                <img src="@item.ProductImageUrl" alt="@item.ProductName" width="50" height="50" class="rounded" />
                <div class="ms-2 flex-grow-1">
                    <div class="fw-semibold text-truncate" title="@item.ProductName">@item.ProductName</div>
                    <small class="text-muted">@String.Format("{0:0.##}", item.ProductPrice) ₺</small>
                </div>
                <a href="javascript:void(0)" class="text-danger" data-fav-remove="@item.FavoriteID" title="Favoriden kaldır">
                    <i class="fa fa-times"></i>
                </a>
            </div>
        }

        <hr class="mt-3 mb-2" />

        <div class="text-center">
            <a href="/Favorite/Index" class="btn btn-premium-fav w-100 fw-bold">
                ❤️ Tüm Favoriler
            </a>
        </div>
    }
    else
    {
        <div class="text-center text-muted py-4">
            Henüz favori eklenmemiş.
        </div>
    }
</div>

<style>
    .mini-fav-item img {
        width: 50px;
        height: 50px;
        object-fit: cover;
        border-radius: 6px;
        border: 1px solid #f1f1f1;
    }

    .btn-premium-fav {
        background: linear-gradient(90deg,#ffc107,#f5b100);
        border: none;
        color: #000;
        transition: .3s;
        box-shadow: 0 4px 12px rgba(0,0,0,.15);
        border-radius: 6px;
    }

        .btn-premium-fav:hover {
            background: linear-gradient(90deg,#e5a900,#d89c00);
            transform: scale(1.02);
            box-shadow: 0 6px 16px rgba(0,0,0,.25);
            color: #fff;
        }

    .mini-fav-item .fa-times {
        font-size: 13px;
        transition: .25s;
    }

        .mini-fav-item .fa-times:hover {
            transform: scale(1.2);
            color: #b50000;
        }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // partial her yüklendiğinde butonları bağla
        document.querySelectorAll('[data-fav-remove]').forEach(btn => {
            btn.addEventListener('click', async () => {
                const id = btn.getAttribute('data-fav-remove');
                const resp = await fetch('/Favorite/RemoveFavoriteAjax?id=' + encodeURIComponent(id), {
                    method: 'POST',
                    credentials: 'include'
                });
                if (!resp.ok) return;
                // dönen HTML yine bu partial olduğu için mini paneli yenile
                const html = await resp.text();
                const panel = document.querySelector('#mini-fav');
                if (panel) panel.innerHTML = html;

                // navbar’daki sayaç için (varsa)
                if (window.loadFavCount) window.loadFavCount();
            });
        });
    });
</script>
